import { WebSocket, WebSocketServer } from "ws";
import { NostrEvent, NostrFilter } from "../types/nostr";
import { NostrMessage } from "../types/protocol";
type EventFilter = NostrFilter;
type SignedEvent = NostrEvent;
type NostrRelayEventMessage = ["EVENT", string, NostrEvent];
interface Subscription {
    filters: EventFilter[];
    instance: ClientSession;
    sub_id: string;
}
export declare class NostrRelay {
    private readonly _emitter;
    private readonly _port;
    private readonly _purge;
    private readonly _subs;
    private _wss;
    private _inMemoryServer;
    private _usingInMemory;
    private _cache;
    private _isClosing;
    private _purgeTimer;
    private _actualPort;
    conn: number;
    constructor(port: number, purge_ival?: number);
    get cache(): NostrEvent[];
    get subs(): Map<string, Subscription>;
    get url(): string;
    get wss(): WebSocketServer;
    start(): Promise<NostrRelay>;
    onconnect(cb: () => void): void;
    close(): Promise<void>;
    store(event: SignedEvent): void;
}
declare class ClientSession {
    private _sid;
    private readonly _relay;
    private readonly _socket;
    private readonly _subs;
    constructor(relay: NostrRelay, socket: WebSocket);
    get sid(): string;
    get relay(): NostrRelay;
    get socket(): WebSocket;
    _cleanup(code: number): void;
    _handler(message: string): void | Promise<void>;
    _onclose(sub_id: string): void;
    _onerr(err: Error): void;
    _onevent(event: SignedEvent): Promise<void>;
    _onreq(sub_id: string, filters: EventFilter[]): void;
    get log(): {
        client: (...msg: unknown[]) => false | void;
        debug: (...msg: unknown[]) => false | void;
        info: (...msg: unknown[]) => false | void;
    };
    addSub(sub_id: string, ...filters: EventFilter[]): void;
    remSub(subId: string): void;
    send(message: NostrMessage | NostrRelayEventMessage): void;
    validateNIP46Event(event: SignedEvent): Promise<boolean>;
}
export {};
