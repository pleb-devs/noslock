/**********************************************************************
 * In-memory WebSocket transport used for environments where creating
 * actual TCP listeners is not permitted (e.g., sandboxed CI). This
 * module provides a minimal subset of the `ws` server/client behaviour
 * that the SNSTR test suite relies on:
 *   - Server side emits `connection`, `message`, `close`, `error`
 *   - Client side exposes the DOM-style WebSocket callbacks
 * The implementation is intentionally lightweight and only supports
 * text frames (strings), which is sufficient for Nostr messages.
 *********************************************************************/
import { EventEmitter } from "events";
import { BivariantHandler, OpenEventLike, CloseEventLike, ErrorEventLike, MessageEventLike } from "./websocket-types";
export interface InMemoryServerSocket extends EventEmitter {
    readyState: number;
    send(data: string): void;
    close(code?: number, reason?: string): void;
    terminate?(): void;
}
export interface InMemoryClientSocket {
    readonly readyState: number;
    onopen: BivariantHandler<OpenEventLike> | null;
    onclose: BivariantHandler<CloseEventLike> | null;
    onerror: BivariantHandler<ErrorEventLike> | null;
    onmessage: BivariantHandler<MessageEventLike> | null;
    send(data: string): void;
    close(code?: number, reason?: string): void;
}
declare class ServerSideSocket extends EventEmitter implements InMemoryServerSocket {
    private readonly server;
    readyState: number;
    private peer;
    constructor(server: InMemoryWebSocketServer);
    attachPeer(peer: ClientSideSocket): void;
    receiveFromClient(data: string): void;
    send(data: string): void;
    close(code?: number, reason?: string): void;
    terminate: () => void;
}
declare class ClientSideSocket implements InMemoryClientSocket {
    private readonly serverSocket;
    readyState: number;
    onopen: BivariantHandler<OpenEventLike> | null;
    onclose: BivariantHandler<CloseEventLike> | null;
    onerror: BivariantHandler<ErrorEventLike> | null;
    onmessage: BivariantHandler<MessageEventLike> | null;
    constructor(serverSocket: ServerSideSocket);
    send(data: string): void;
    close(code?: number, reason?: string): void;
    receiveFromServer(data: string): void;
    handleServerClosure(code?: number, reason?: string): void;
    handleServerError(error: Error): void;
}
export declare class InMemoryWebSocketServer extends EventEmitter {
    clients: Set<ServerSideSocket>;
    readonly port: number;
    constructor(port: number);
    connectClient(): InMemoryClientSocket;
    close(): void;
    deregister(socket: ServerSideSocket): void;
}
export declare function registerInMemoryServer(requestedPort?: number): {
    port: number;
    server: InMemoryWebSocketServer;
};
export declare function getInMemoryServer(port: number): InMemoryWebSocketServer | undefined;
export declare function unregisterInMemoryServer(port: number): void;
export declare function createInMemoryWebSocket(url: string): InMemoryClientSocket | undefined;
export {};
