/**
 * NIP-57 Zap Client implementation
 * Provides high-level functionality for working with zaps in Nostr
 *
 * The NostrZapClient provides a comprehensive interface for:
 * - Sending zaps to users and events
 * - Fetching and validating zap receipts
 * - Calculating zap statistics
 * - Working with zap splits
 */
import { NostrEvent } from "../types/nostr";
import { LnurlSuccessAction } from "./types";
import { Nostr } from "../nip01/nostr";
import { ZapValidationResult, parseZapSplit } from "./index";
/**
 * Options for the ZapClient
 */
export interface ZapClientOptions {
    /** The Nostr client instance to use for relay communication */
    nostrClient: Nostr;
    /** Default relay URLs to use when not specified explicitly */
    defaultRelays?: string[];
}
/**
 * Result of generating a zap invoice
 */
export interface ZapInvoiceResult {
    /** The bolt11 invoice string */
    invoice: string;
    /** The zap request event that was used to generate the invoice */
    zapRequest: NostrEvent;
    /** The optional payment hash of the invoice */
    paymentHash?: string;
    /** Optional success action to be performed after payment */
    successAction?: LnurlSuccessAction;
    /** Error message if invoice generation failed */
    error?: string;
}
/**
 * Filter options for fetching zaps
 */
export interface ZapFilterOptions {
    /** Maximum number of zaps to fetch */
    limit?: number;
    /** Fetch zaps created after this timestamp */
    since?: number;
    /** Fetch zaps created before this timestamp */
    until?: number;
    /** Filter zaps by these author pubkeys */
    authors?: string[];
    /** Filter zaps for these event IDs */
    events?: string[];
}
/**
 * Statistics about zaps for a user or event
 */
export interface ZapStats {
    /** Total amount received in millisats */
    total: number;
    /** Number of zaps received */
    count: number;
    /** Largest single zap amount in millisats */
    largest?: number;
    /** Smallest single zap amount in millisats */
    smallest?: number;
    /** Average zap amount in millisats */
    average?: number;
    /** First zap timestamp */
    firstAt?: number;
    /** Latest zap timestamp */
    latestAt?: number;
}
/**
 * Client for working with Lightning Zaps (NIP-57)
 *
 * This client provides high-level methods for sending zaps,
 * fetching zap receipts, and calculating zap statistics.
 */
export declare class NostrZapClient {
    private client;
    private defaultRelays;
    /**
     * Create a new zap client
     * @param options Options for configuring the client
     */
    constructor(options: {
        /** The Nostr client instance to use */
        client: Nostr;
        /** Default relay URLs to use when not specified explicitly */
        defaultRelays?: string[];
    });
    /**
     * Private method to safely unsubscribe from a subscription
     *
     * @param subscriptionIds Array of subscription IDs
     * @param context Context string for error logging
     */
    private cleanupSubscription;
    /**
     * Check if a user can receive zaps
     *
     * This method checks if a user's LNURL endpoint supports NIP-57 Nostr zaps.
     *
     * @param pubkey The user's public key
     * @param lnurl Optional LNURL from profile (if known)
     * @returns Whether the user can receive zaps
     */
    canReceiveZaps(pubkey: string, lnurl?: string): Promise<boolean>;
    /**
     * Send a zap to a user or event
     *
     * This method:
     * 1. Creates a zap request
     * 2. Sends it to the recipient's LNURL server
     * 3. Returns the invoice for payment
     *
     * Note: After getting the invoice, you need to pay it with a Lightning wallet.
     * The LNURL server will create and publish a zap receipt after payment.
     *
     * @param options Zap options including recipient, amount, and comment
     * @param privateKey Private key for signing the request
     * @returns Object with success status and invoice or error
     */
    sendZap(options: {
        /** Public key of the recipient */
        recipientPubkey: string;
        /** LNURL of the recipient */
        lnurl: string;
        /** Amount in millisats to send */
        amount: number;
        /** Optional comment to include with the zap */
        comment?: string;
        /** Event ID to zap (if zapping a specific event) */
        eventId?: string;
        /** A-tag coordinates (for parameterized replaceable events) */
        aTag?: string;
        /** Override default relays for zap receipt publishing */
        relays?: string[];
        /** Whether to send as an anonymous zap */
        anonymousZap?: boolean;
    }, privateKey: string): Promise<{
        success: boolean;
        invoice?: string;
        error?: string;
    }>;
    /**
     * Fetch zaps received by a user
     *
     * @param pubkey User's public key
     * @param options Filter options
     * @returns Array of zap receipt events
     */
    fetchUserReceivedZaps(pubkey: string, options?: ZapFilterOptions): Promise<NostrEvent[]>;
    /**
     * Fetch zaps sent by a user
     *
     * @param pubkey User's public key
     * @param options Filter options
     * @returns Array of zap receipt events
     */
    fetchUserSentZaps(pubkey: string, options?: ZapFilterOptions): Promise<NostrEvent[]>;
    /**
     * Fetch zaps for a specific event
     *
     * @param eventId The event ID to get zaps for
     * @param options Filter options
     * @returns Array of zap receipt events
     */
    fetchEventZaps(eventId: string, options?: ZapFilterOptions): Promise<NostrEvent[]>;
    /**
     * Fetch all zap receipts matching the filter criteria
     *
     * @param options Filter options
     * @returns Array of zap receipt events
     */
    fetchZapReceipts(options?: ZapFilterOptions): Promise<NostrEvent[]>;
    /**
     * Validate a zap receipt
     *
     * This validates that:
     * 1. The receipt is properly formatted
     * 2. The signature is valid
     * 3. The description hash in the bolt11 invoice matches the zap request
     * 4. The amount matches between invoice and zap request
     *
     * @param zapReceipt The zap receipt event to validate
     * @param lnurlPubkey Public key of the LNURL server (if known)
     * @returns Validation result with details
     */
    validateZapReceipt(zapReceipt: NostrEvent, lnurlPubkey?: string): ZapValidationResult;
    /**
     * Calculate total zaps received by a user
     *
     * @param pubkey User's public key
     * @param options Filter options
     * @returns Zap statistics
     */
    getTotalZapsReceived(pubkey: string, options?: ZapFilterOptions): Promise<ZapStats>;
    /**
     * Calculate total zaps for a specific event
     *
     * @param eventId Event ID to calculate zaps for
     * @param options Filter options
     * @returns Zap statistics
     */
    getTotalZapsForEvent(eventId: string, options?: ZapFilterOptions): Promise<ZapStats>;
    /**
     * Parse zap split information from an event
     *
     * @param event The event to parse zap split information from
     * @returns Array of zap split recipients with weights
     */
    parseZapSplit(event: NostrEvent): {
        pubkey: string;
        relay: string;
        weight: number;
    }[];
    /**
     * Calculate zap split amounts
     *
     * @param totalAmount Total amount to split in millisats
     * @param splitInfo Array of zap split recipients with weights
     * @returns Array of recipients with calculated amounts
     */
    calculateZapSplitAmounts(totalAmount: number, splitInfo: ReturnType<typeof parseZapSplit>): {
        pubkey: string;
        relay: string;
        amount: number;
    }[];
}
/**
 * Client for working with NIP-57 Zaps
 */
export declare class ZapClient {
    private nostrClient;
    private defaultRelays;
    private lnurlCache;
    /**
     * Create a new ZapClient
     * @param options Options for the client
     */
    constructor(options: ZapClientOptions);
    /**
     * Check if a user has a valid LNURL that supports zaps
     * @param pubkey User's public key
     * @param lnurlFromProfile LNURL from the user's profile (optional)
     * @returns Whether the user can receive zaps
     */
    canReceiveZaps(pubkey: string, lnurlFromProfile?: string): Promise<boolean>;
    /**
     * Generate a zap invoice for a user or event
     * @param options Options for the zap
     * @param privateKey Private key to sign the zap request
     * @returns Zap invoice result
     */
    getZapInvoice(options: {
        recipientPubkey: string;
        lnurl: string;
        amount: number;
        comment?: string;
        eventId?: string;
        aTag?: string;
        relays?: string[];
        anonymousZap?: boolean;
    }, privateKey: string): Promise<ZapInvoiceResult>;
    /**
     * Validate a zap receipt
     * @param zapReceipt Zap receipt event
     * @param lnurlPubkey LNURL server pubkey
     * @returns Validation result
     */
    validateZapReceipt(zapReceipt: NostrEvent, lnurlPubkey: string): ZapValidationResult;
    /**
     * Handle zap splits for an event
     * @param event Event with zap split tags
     * @param totalAmount Total amount to split
     * @returns Split information for each recipient
     */
    getZapSplitAmounts(event: NostrEvent, totalAmount: number): {
        pubkey: string;
        relay: string;
        amount: number;
    }[];
}
